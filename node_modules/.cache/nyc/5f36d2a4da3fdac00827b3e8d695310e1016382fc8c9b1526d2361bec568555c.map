{"version":3,"sources":["UserController.js"],"names":["dotenv","config","UserController","request","response","body","email","firstName","lastName","password","i","users","length","status","json","error","salt","bcrypt","genSaltSync","hash","hashSync","user","id","type","isAdmin","push","token","jwt","sign","process","env","SECRET","expiresIn","header","data","login","filter","result","compareSync"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEAA,iBAAOC,MAAP;;IAEMC,c;;;;;;;2BACUC,O,EAASC,Q,EAAU;AAAA,0BAG3BD,QAAQE,IAHmB;AAAA,UAE7BC,KAF6B,iBAE7BA,KAF6B;AAAA,UAEtBC,SAFsB,iBAEtBA,SAFsB;AAAA,UAEXC,QAFW,iBAEXA,QAFW;AAAA,UAEDC,QAFC,iBAEDA,QAFC;;AAI/B,WAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIC,gBAAMC,MAA1B,EAAkCF,KAAK,CAAvC,EAA0C;AACxC,YAAIC,gBAAMD,CAAN,EAASJ,KAAT,KAAmBA,KAAvB,EAA8B;AAC5B,iBAAOF,SAASS,MAAT,CAAgB,GAAhB,EAAqBC,IAArB,CAA0B;AAC/BD,oBAAQ,GADuB;AAE/BE,mBAAO;AAFwB,WAA1B,CAAP;AAID;AACF;AACD,UAAMC,OAAOC,iBAAOC,WAAP,CAAmB,EAAnB,CAAb;AACA,UAAMC,OAAOF,iBAAOG,QAAP,CAAgBX,QAAhB,EAA0BO,IAA1B,CAAb;AACA,UAAMK,OAAO;AACXC,YAAIX,gBAAMC,MAAN,GAAe,CADR;AAEXN,oBAFW;AAGXC,4BAHW;AAIXC,0BAJW;AAKXW,kBALW;AAMXI,cAAM,OANK;AAOXC,iBAAS;AAPE,OAAb;AASAb,sBAAMc,IAAN,CAAWJ,IAAX;AACA,UAAMK,QAAQC,uBAAIC,IAAJ,CAAS;AACrBtB,eAAOe,KAAKf,KADS;AAErBgB,YAAID,KAAKC,EAFY;AAGrBE,iBAASH,KAAKG,OAHO;AAIrBD,cAAMF,KAAKE;AAJU,OAAT,EAKXM,QAAQC,GAAR,CAAYC,MALD,EAKS,EAAEC,WAAW,IAAb,EALT,CAAd;AAMA,aAAO5B,SAAS6B,MAAT,CAAgB,gBAAhB,EAAkCP,KAAlC,EAAyCb,MAAzC,CAAgD,GAAhD,EAAqDC,IAArD,CAA0D;AAC/DD,gBAAQ,GADuD;AAE/DqB,cAAM;AACJR,sBADI;AAEJnB,8BAFI;AAGJC,4BAHI;AAIJF,sBAJI;AAKJG,oBAAUU,IALN;AAMJK,mBAAS,IANL;AAOJD,gBAAM;AAPF;AAFyD,OAA1D,CAAP;AAYD;;;0BAEYpB,O,EAASC,Q,EAAU;AAAA,2BACFD,QAAQE,IADN;AAAA,UACtBC,KADsB,kBACtBA,KADsB;AAAA,UACfG,QADe,kBACfA,QADe;;AAE9B,UAAM0B,QAAQxB,gBAAMyB,MAAN,CAAa;AAAA,eAAQf,KAAKf,KAAL,KAAeA,KAAvB;AAAA,OAAb,CAAd;AACA,UAAI6B,MAAMvB,MAAN,GAAe,CAAnB,EAAsB;AACpB,eAAOR,SAASS,MAAT,CAAgB,GAAhB,EAAqBC,IAArB,CAA0B;AAC/BD,kBAAQ,GADuB;AAE/BE,iBAAO;AAFwB,SAA1B,CAAP;AAID;AACD,UAAMsB,SAASpB,iBAAOqB,WAAP,CAAmB7B,QAAnB,EAA6B0B,MAAM,CAAN,EAAShB,IAAtC,CAAf;AACA,UAAIkB,MAAJ,EAAY;AACV,YAAMX,QAAQC,uBAAIC,IAAJ,CAAS;AACrBtB,iBAAO6B,MAAM,CAAN,EAAS7B,KADK;AAErBgB,cAAIa,MAAM,CAAN,EAASb,EAFQ;AAGrBE,mBAASW,MAAM,CAAN,EAASX,OAHG;AAIrBD,gBAAMY,MAAM,CAAN,EAASZ;AAJM,SAAT,EAKXM,QAAQC,GAAR,CAAYC,MALD,EAKS,EAAEC,WAAW,IAAb,EALT,CAAd;AAMA,eAAO5B,SAASS,MAAT,CAAgB,GAAhB,EAAqBC,IAArB,CAA0B;AAC/BD,kBAAQ,GADuB;AAE/BqB,gBAAM;AACJR,wBADI;AAEJnB,uBAAW4B,MAAM,CAAN,EAAS5B,SAFhB;AAGJC,sBAAU2B,MAAM,CAAN,EAAS3B,QAHf;AAIJF,mBAAO6B,MAAM,CAAN,EAAS7B,KAJZ;AAKJG,sBAAU0B,MAAM,CAAN,EAAShB;AALf;AAFyB,SAA1B,CAAP;AAUD;AACD,aAAOf,SAASS,MAAT,CAAgB,GAAhB,EAAqBC,IAArB,CAA0B;AAC/BC,eAAO;AADwB,OAA1B,CAAP;AAGD;;;;;;kBAGYb,c","file":"UserController.js","sourceRoot":"C:/Users/nono.DESKTOP-OPOSFU3/Desktop/andela-banka/server/controllers","sourcesContent":["import bcrypt from 'bcrypt';\r\nimport dotenv from 'dotenv';\r\nimport jwt from 'jsonwebtoken';\r\nimport users from '../db/users';\r\n\r\ndotenv.config();\r\n\r\nclass UserController {\r\n  static signup(request, response) {\r\n    const {\r\n      email, firstName, lastName, password,\r\n    } = request.body;\r\n    for (let i = 0; i < users.length; i += 1) {\r\n      if (users[i].email === email) {\r\n        return response.status(409).json({\r\n          status: 409,\r\n          error: 'Email already Exist',\r\n        });\r\n      }\r\n    }\r\n    const salt = bcrypt.genSaltSync(10);\r\n    const hash = bcrypt.hashSync(password, salt);\r\n    const user = {\r\n      id: users.length + 1,\r\n      email,\r\n      firstName,\r\n      lastName,\r\n      hash,\r\n      type: 'staff',\r\n      isAdmin: true,\r\n    };\r\n    users.push(user);\r\n    const token = jwt.sign({\r\n      email: user.email,\r\n      id: user.id,\r\n      isAdmin: user.isAdmin,\r\n      type: user.type,\r\n    }, process.env.SECRET, { expiresIn: '1h' });\r\n    return response.header('x-access-token', token).status(201).json({\r\n      status: 201,\r\n      data: {\r\n        token,\r\n        firstName,\r\n        lastName,\r\n        email,\r\n        password: hash,\r\n        isAdmin: true,\r\n        type: 'staff',\r\n      },\r\n    });\r\n  }\r\n\r\n  static login(request, response) {\r\n    const { email, password } = request.body;\r\n    const login = users.filter(user => user.email === email);\r\n    if (login.length < 1) {\r\n      return response.status(404).json({\r\n        status: 404,\r\n        error: 'user not found',\r\n      });\r\n    }\r\n    const result = bcrypt.compareSync(password, login[0].hash);\r\n    if (result) {\r\n      const token = jwt.sign({\r\n        email: login[0].email,\r\n        id: login[0].id,\r\n        isAdmin: login[0].isAdmin,\r\n        type: login[0].type,\r\n      }, process.env.SECRET, { expiresIn: '1h' });\r\n      return response.status(200).json({\r\n        status: 200,\r\n        data: {\r\n          token,\r\n          firstName: login[0].firstName,\r\n          lastName: login[0].lastName,\r\n          email: login[0].email,\r\n          password: login[0].hash,\r\n        },\r\n      });\r\n    }\r\n    return response.status(400).json({\r\n      error: 'password invalid',\r\n    });\r\n  }\r\n}\r\n\r\nexport default UserController;\r\n"]}