{"version":3,"sources":["UserController.js"],"names":["dotenv","config","UserController","request","response","body","email","firstName","lastName","password","i","users","length","status","json","error","bcrypt","hash","user","id","type","isAdmin","push","token","jwt","sign","process","env","SECRET","expiresIn","header","data"],"mappings":"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","file":"UserController.js","sourceRoot":"C:/Users/nono.DESKTOP-OPOSFU3/Desktop/andela-banka/server/controllers","sourcesContent":["import bcrypt from 'bcrypt';\r\nimport dotenv from 'dotenv';\r\nimport jwt from 'jsonwebtoken';\r\nimport users from '../db/users';\r\n\r\ndotenv.config();\r\n\r\nclass UserController {\r\n  static signup(request, response) {\r\n    const {\r\n      email, firstName, lastName, password,\r\n    } = request.body;\r\n    for (let i = 0; i < users.length; i += 1) {\r\n      if (users[i].email === email) {\r\n        return response.status(409).json({\r\n          status: 409,\r\n          error: 'Email already Exist',\r\n        });\r\n      }\r\n    }\r\n    bcrypt.hash(password, 10, (error, hash) => {\r\n      if (error) {\r\n        return response.status(500).json({\r\n          status: 500,\r\n          error,\r\n        });\r\n      }\r\n      const user = {\r\n        id: users.length + 1,\r\n        email,\r\n        firstName,\r\n        lastName,\r\n        password,\r\n        type: 'staff',\r\n        isAdmin: true,\r\n      };\r\n      users.push(user);\r\n      const token = jwt.sign({\r\n        email: users.email,\r\n        id: user.id,\r\n        isAdmin: user.isAdmin,\r\n        type: user.type,\r\n      }, process.env.SECRET, { expiresIn: '1h' });\r\n      return response.header('x-access-token', token).status(201).json({\r\n        status: 201,\r\n        data: {\r\n          token,\r\n          firstName,\r\n          lastName,\r\n          email,\r\n          password: hash,\r\n          isAdmin: true,\r\n          type: 'staff',\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  static login(request, response) {\r\n    const {\r\n      email, password,\r\n    } = request.body;\r\n    for (let i = 0; i < users.length; i += 1) {\r\n      if (users[i].email === email && users[i].password === password) {\r\n        const token = jwt.sign({\r\n          email: users[i].email,\r\n          id: users[i].id,\r\n          isAdmin: users[i].isAdmin,\r\n          type: users[i].type,\r\n        }, process.env.SECRET, { expiresIn: '1h' });\r\n        return response.header('x-access-token', token).status(200).json({\r\n          status: 200,\r\n          data: {\r\n            token,\r\n            id: users[i].id,\r\n            firstName: users[i].firstName,\r\n            lastName: users[i].lastName,\r\n            email,\r\n            type: users[i].type,\r\n            isAdmin: users[i].isAdmin,\r\n          },\r\n        });\r\n      }\r\n    }\r\n    return response.status(404).json({\r\n      status: 404,\r\n      error: 'Email or Password is Incorrect',\r\n    });\r\n  }\r\n}\r\n\r\nexport default UserController;\r\n"]}